<template>
  <span>
    <transition name="modal">
      <div v-if="isOpen">
        <div class="overlay" @click.self="isOpen = false;">
          <div class="modal">
            <h3>Register</h3>
            <form class="login" @submit.prevent="addNewUser">
            <label>Username</label>
            <input required v-model="user" type="text" placeholder="Username"/>
            <br>
            <label>E-mail</label>
            <input v-model="email" type="text" placeholder="john@example.com"/>
            <br>
            <label>Password</label>
            <input required v-model="pass" type="password" placeholder="Password"/>
            <br>
            <label>Confirm password</label>
            <input requierd v-model="confirm_pass" type="password" placeholder="Confirm password"/>
            <br>
            <button type="submit">Register</button>
            <button type="reset" @click="isOpen=false">Cancel</button>
            </form>
            <div v-if="msg!=''"> {{msg}} </div>
          </div>
        </div>
      </div>
    </transition>
    <div class="box" @click="isOpen = true">
      Don't yet have an account? Register here
    </div>
  </span>
</template>

<script>
import axios from 'axios'

export default {
    name: "NewUser",
    data() {
        return {
            isOpen: false,
            user: String(),
            email: String(),
            pass: String(),
            confirm_pass: String(),
            msg: String()
        }
    },
    methods: {
        addNewUser: function() {
            let username = this.user;
            let email = this.email;
            let password = this.pass;
            let confirm_password = this.confirm_pass;

            if (password != confirm_password) {
              this.msg = "Passwords do not match";
              return;
            }

            let request_data = Object();
            if (username != "") request_data.username = username;
            if (email != "") request_data.email = email;
            if (password != "") request_data.password = password;
            
            let request_config =  {
              method: 'post',
              url: 'http://api.zrak.janvr.wtf/users',
              data: request_data
            }

            axios(request_config)
            .then(() => {
              window.location.reload();
            })
            .catch(error => {
              this.msg = error.response.data;
            })
        }
    }
}
</script>

<style scoped>
.modal {
  width: 500px;
  margin: 0px auto;
  padding: 20px;
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0 2px 8px 3px;
  transition: all 0.2s ease-in;
}
.fadeIn-enter {
  opacity: 0;
}

.fadeIn-leave-active {
  opacity: 0;
  transition: all 0.2s step-end;
}

.fadeIn-enter .modal,
.fadeIn-leave-active.modal {
  transform: scale(1.1);
}

/* button {
  padding: 7px;
  margin-top: 10px;
  background-color: green;
  color: white;
  font-size: 1.1rem;
} */

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  background: #00000094;
  z-index: 999;
  transition: opacity 0.2s ease;
}
</style>